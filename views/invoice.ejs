<!DOCTYPE html>
<html>
<head>
    <title>Invoice #<%= order.id %></title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/styles.css">
    <style>
        @media print {
            .no-print {
                display: none;
            }
            .navbar {
                display: none;
            }
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">Supermarket App</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link" href="/shopping">Shop</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/cart">Cart</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/orders">My Orders</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/logout">Logout</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-4">
    <div id="invoice-content">
        <h2>Invoice #<%= order.id %></h2>

        <% if (errors && errors.length > 0) { %>
          <div class="alert alert-danger">
            <% errors.forEach(function(error) { %>
              <p class="mb-0"><%= error %></p>
            <% }); %>
          </div>
        <% } %>

        <% if (messages && messages.length > 0) { %>
          <div class="alert alert-success">
            <% messages.forEach(function(message) { %>
              <p class="mb-0"><%= message %></p>
            <% }); %>
          </div>
        <% } %>

        <!-- Customer & order info -->
        <div class="row mb-4">
          <div class="col-md-6">
            <h5>Billing To:</h5>
            <p class="mb-0"><strong><%= user.username %></strong></p>
            <p class="mb-0"><%= user.email %></p>
            <% if (user.address) { %>
              <p class="mb-0"><%= user.address %></p>
            <% } %>
            <% if (user.contact) { %>
              <p class="mb-0">Contact: <%= user.contact %></p>
            <% } %>
          </div>
          <div class="col-md-6 text-md-end">
            <h5>Order Details:</h5>
            <p class="mb-0">Order ID: <%= order.id %></p>
            <p class="mb-0">Date: <%= order.orderDate.toLocaleString ? order.orderDate.toLocaleString() : order.orderDate %></p>
            <p class="mb-0">Total: $<%= order.totalAmount.toFixed ? order.totalAmount.toFixed(2) : order.totalAmount %></p>
          </div>
        </div>

        <!-- Items table -->
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Product</th>
              <th>Qty</th>
              <th>Price</th>
              <th>Line Total</th>
            </tr>
          </thead>
          <tbody>
            <% let computedTotal = 0; %>
            <% items.forEach(function(item) { %>
              <tr>
                <td><%= item.productName %></td>
                <td><%= item.quantity %></td>
                <td>$<%= item.price.toFixed ? item.price.toFixed(2) : item.price %></td>
                <td>$<%= item.lineTotal.toFixed ? item.lineTotal.toFixed(2) : item.lineTotal %></td>
              </tr>
              <% computedTotal += parseFloat(item.lineTotal); %>
            <% }); %>
          </tbody>
        </table>

        <div class="text-end">
          <h4>Grand Total: $<%= computedTotal.toFixed ? computedTotal.toFixed(2) : computedTotal %></h4>
          <p class="text-muted">* The total here should match the order total in the header.</p>
        </div>
    </div>

    <div class="mt-4 no-print">
      <button class="btn btn-primary" onclick="printInvoice()">
        <i class="bi bi-printer"></i> Print Invoice
      </button>
      <a href="/orders" class="btn btn-secondary ms-2">Back to Orders</a>
      <a href="/shopping" class="btn btn-primary ms-2">Continue Shopping</a>
    </div>
</div>

<script>
function printInvoice() {
    window.print();
}
</script>
</body>
</html>